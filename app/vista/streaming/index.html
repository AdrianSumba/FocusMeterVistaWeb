<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Streaming en tiempo real - FocusMeter</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <!-- MJPEG: un solo request persistente (fluido y liviano) -->
    <img id="videoStream" src="http://localhost:8000/stream" alt="Cargando streaming..." />
    <div id="status">Conectando al servidor...</div>
  </div>

  <script>
    const img = document.getElementById('videoStream');
    const status = document.getElementById('status');

    function setOk(){
      status.innerText = "Streaming activo";
      status.style.color = "#00ff00";
    }

    function setErr(){
      status.innerText = "Sin conexión - reintentando...";
      status.style.color = "#ff0000";
    }

    // Cuando el navegador logra descargar el primer chunk, suele disparar load.
    img.addEventListener("load", setOk);

    // Reintento si falla.
    img.addEventListener("error", () => {
      setErr();
      setTimeout(() => {
        img.src = "http://localhost:8000/stream?t=" + Date.now();
      }, 1000);
    });

    // Por defecto, al abrir la página: conectar.
    setErr();
  </script>
</body>
</html>
